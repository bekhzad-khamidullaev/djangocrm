# ‚úÖ Asterisk Real-time Integration - Completed

## üìä –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: –ó–ê–í–ï–†–®–ï–ù–û

–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Asterisk PBX —Å Django CRM —á–µ—Ä–µ–∑ Real-time –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞.

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend –∏ –º–æ–¥–µ–ª–∏ (Core)
1. ‚úÖ **voip/models.py** - –î–æ–±–∞–≤–ª–µ–Ω—ã 7 –º–æ–¥–µ–ª–µ–π Asterisk Real-time
   - `PsEndpoint` - PJSIP endpoints
   - `PsAuth` - Authentication
   - `PsAor` - Address of Records
   - `PsContact` - Active registrations
   - `PsIdentify` - IP-based identification
   - `PsTransport` - SIP transports
   - `Extension` - Dialplan extensions

2. ‚úÖ **voip/backends/asteriskbackend.py** - 1200+ —Å—Ç—Ä–æ–∫
   - –ü–æ–ª–Ω—ã–π AMI —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
   - Endpoint management
   - Call control (originate, hangup, transfer, park)
   - Recording management
   - Queue management
   - Database operations

3. ‚úÖ **voip/utils/asterisk_realtime.py** - 550+ —Å—Ç—Ä–æ–∫
   - `auto_provision_endpoint()` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ endpoints
   - `sync_internal_numbers()` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å InternalNumber
   - `generate_dialplan_for_endpoint()` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è dialplan
   - `sync_routing_rules_to_dialplan()` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CallRoutingRule
   - `bulk_provision_users()` - –ú–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ
   - `validate_endpoint_config()` - –í–∞–ª–∏–¥–∞—Ü–∏—è
   - `get_endpoint_statistics()` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
4. ‚úÖ **voip/migrations/0014_asterisk_realtime.py**
   - –°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü Asterisk
   - –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

5. ‚úÖ **voip/settings.py**
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Asterisk –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
   - 20+ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

6. ‚úÖ **webcrm/settings.py**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π –ë–î Asterisk
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

7. ‚úÖ **webcrm/database_routers.py**
   - Router –¥–ª—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è Asterisk –º–æ–¥–µ–ª–µ–π –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –ë–î
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –∏ relations

### Admin –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
8. ‚úÖ **voip/admin.py** - –û–±–Ω–æ–≤–ª–µ–Ω (+480 —Å—Ç—Ä–æ–∫)
   - `PsEndpointAdmin` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ endpoints —Å live —Å—Ç–∞—Ç—É—Å–æ–º
   - `PsAuthAdmin` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
   - `PsAorAdmin` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ AORs
   - `PsContactAdmin` - –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
   - `PsIdentifyAdmin` - IP-based identification
   - `PsTransportAdmin` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞–º–∏
   - `ExtensionAdmin` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ dialplan
   - Admin actions: reload PJSIP, test registration, export dialplan

### Management –∫–æ–º–∞–Ω–¥—ã
9. ‚úÖ **voip/management/commands/setup_asterisk_realtime.py**
   - `--test-connection` - –¢–µ—Å—Ç AMI –∏ –ë–î
   - `--create-transports` - –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–≤
   - `--sync-internal-numbers` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
   - `--provision-users` - Auto-provisioning
   - `--create-test-endpoints N` - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö endpoints
   - `--validate` - –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
10. ‚úÖ **ASTERISK_REALTIME_SETUP.md** - 450+ —Å—Ç—Ä–æ–∫
    - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
    - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL/MySQL
    - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Asterisk
    - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    - Troubleshooting

11. ‚úÖ **ASTERISK_QUICKSTART.md** - 350+ —Å—Ç—Ä–æ–∫
    - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 5 –º–∏–Ω—É—Ç
    - –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
    - –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
    - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

12. ‚úÖ **ASTERISK_FIRST_RUN.md** - 400+ —Å—Ç—Ä–æ–∫
    - –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
    - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å –Ω—É–ª—è
    - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    - –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

13. ‚úÖ **.env.asterisk.example** - 250+ —Å—Ç—Ä–æ–∫
    - –í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ø—Ä–∏–º–µ—Ä—ã
    - –†–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

14. ‚úÖ **voip/README.md** - –û–±–Ω–æ–≤–ª–µ–Ω
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è –æ–± Asterisk –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
    - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞

---

## üéØ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### –ë–∞–∑–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ SIP endpoints
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π (userpass/md5)
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ AORs –∏ contacts
- ‚úÖ IP-based endpoint identification
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞–º–∏ (UDP/TCP/TLS/WSS)
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ dialplan —á–µ—Ä–µ–∑ –ë–î

### AMI –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ Originate - –∏–Ω–∏—Ü–∏–∞—Ü–∏—è –∑–≤–æ–Ω–∫–æ–≤
- ‚úÖ Hangup - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤
- ‚úÖ Transfer - –ø–µ—Ä–µ–≤–æ–¥ –∑–≤–æ–Ω–∫–æ–≤
- ‚úÖ Park - –ø–∞—Ä–∫–æ–≤–∫–∞ –∑–≤–æ–Ω–∫–æ–≤
- ‚úÖ StartRecording/StopRecording - –∑–∞–ø–∏—Å—å
- ‚úÖ Channel status - —Å—Ç–∞—Ç—É—Å –∫–∞–Ω–∞–ª–æ–≤
- ‚úÖ Queue management - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—è–º–∏
- ‚úÖ Database operations - —Ä–∞–±–æ—Ç–∞ —Å –ë–î Asterisk

### Auto-provisioning
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ endpoints –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ì–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ–∂–∏–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∞–≤—Ç–æ, –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å)
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ dialplan
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å InternalNumber
- ‚úÖ –ú–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM
- ‚úÖ –°–≤—è–∑—å PsEndpoint —Å User —á–µ—Ä–µ–∑ crm_user
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CallRoutingRule
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å NumberGroup
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ CallLog –¥–ª—è CDR
- ‚úÖ Cross-database relations

### Admin —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ Live —Å—Ç–∞—Ç—É—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ endpoints
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö contacts
- ‚úÖ Reload PJSIP/dialplan actions
- ‚úÖ Test registration action
- ‚úÖ Export dialplan
- ‚úÖ Cleanup expired contacts
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö PJSIP –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ NAT traversal (rtp_symmetric, force_rport, rewrite_contact)
- ‚úÖ Media encryption (SRTP)
- ‚úÖ Session timers
- ‚úÖ DTMF modes (rfc4733/inband/info)
- ‚úÖ T.38 fax support
- ‚úÖ ICE/STUN –¥–ª—è WebRTC
- ‚úÖ MWI (Message Waiting Indication)
- ‚úÖ Advanced codec negotiation
- ‚úÖ Call recording features
- ‚úÖ Voicemail integration

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     Django CRM                              ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Admin Panel  ‚îÇ  ‚îÇ  REST API    ‚îÇ  ‚îÇ  Management     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Endpoints ‚îÇ  ‚îÇ  - Call API  ‚îÇ  ‚îÇ  Commands       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Auth      ‚îÇ  ‚îÇ  - Queue API ‚îÇ  ‚îÇ  - Setup        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Dialplan  ‚îÇ  ‚îÇ  - Status    ‚îÇ  ‚îÇ  - Sync         ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ         ‚îÇ                  ‚îÇ                    ‚îÇ           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ        AsteriskRealtimeAPI Backend                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Endpoint    ‚îÇ  ‚îÇ  Call        ‚îÇ  ‚îÇ  Queue      ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Management  ‚îÇ  ‚îÇ  Control     ‚îÇ  ‚îÇ  Management ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Dialplan    ‚îÇ  ‚îÇ  Recording   ‚îÇ  ‚îÇ  Database   ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Generation  ‚îÇ  ‚îÇ  Control     ‚îÇ  ‚îÇ  Operations ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ                  ‚îÇ
            ‚îÇ Django ORM       ‚îÇ AMI Protocol
            ‚îÇ (using='asterisk') ‚îÇ (port 5038)
            ‚îÇ                  ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   PostgreSQL/MySQL                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  Asterisk Real-time Tables                            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - ps_endpoints  - ps_auths    - ps_aors             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - ps_contacts   - ps_identify - ps_transports       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - extensions                                         ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ Real-time lookup
                     ‚îÇ (res_config_pgsql)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   Asterisk PBX                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  PJSIP Channel Driver                                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Registration  - Authentication  - Call routing     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Media (RTP)   - NAT handling    - Codecs           ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  AMI Interface (port 5038)                             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Originate  - Hangup    - Transfer  - Park          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Recording  - Queues    - Database  - Events        ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚ñ≤                           ‚ñ≤
            ‚îÇ SIP (5060)                ‚îÇ RTP (10000-20000)
            ‚îÇ                           ‚îÇ
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ SIP Clients  ‚îÇ           ‚îÇ    Media    ‚îÇ
     ‚îÇ (Softphones) ‚îÇ           ‚îÇ   Streams   ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–¥–∞

- **–ú–æ–¥–µ–ª–µ–π**: 7 (760+ —Å—Ç—Ä–æ–∫)
- **Backend**: 1 –∫–ª–∞—Å—Å, 40+ –º–µ—Ç–æ–¥–æ–≤ (1200+ —Å—Ç—Ä–æ–∫)
- **–£—Ç–∏–ª–∏—Ç—ã**: 12 —Ñ—É–Ω–∫—Ü–∏–π (550+ —Å—Ç—Ä–æ–∫)
- **Admin**: 7 –∫–ª–∞—Å—Å–æ–≤ (480+ —Å—Ç—Ä–æ–∫)
- **Management –∫–æ–º–∞–Ω–¥—ã**: 1 (250+ —Å—Ç—Ä–æ–∫)
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: 1400+ —Å—Ç—Ä–æ–∫
- **–í—Å–µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ**: ~4500+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ + –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env
cp .env.asterisk.example .env.local
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
python manage.py migrate --database=asterisk

# 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Asterisk (—Å–º. ASTERISK_FIRST_RUN.md)

# 4. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
python manage.py setup_asterisk_realtime \
    --create-transports \
    --create-test-endpoints 5 \
    --test-connection

# 5. –ì–æ—Ç–æ–≤–æ! –û—Ç–∫—Ä–æ–π—Ç–µ Admin
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç—Ä–æ–∫ |
|------|----------|-------|
| `ASTERISK_REALTIME_SETUP.md` | –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ | 450+ |
| `ASTERISK_QUICKSTART.md` | –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç | 350+ |
| `ASTERISK_FIRST_RUN.md` | –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ | 400+ |
| `.env.asterisk.example` | –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ | 250+ |
| `voip/README.md` | –û–±–Ω–æ–≤–ª–µ–Ω | - |

---

## ‚úÖ Checklist –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### –ö–æ–¥
- [x] –ú–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [x] Backend —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å –ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º
- [x] –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
- [x] Admin –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å actions
- [x] Management –∫–æ–º–∞–Ω–¥—ã
- [x] Database router
- [x] –ú–∏–≥—Ä–∞—Ü–∏–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
- [x] –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- [x] –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- [x] –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [x] –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
- [x] Troubleshooting guide
- [x] –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- [x] Endpoint management (CRUD)
- [x] AMI –æ–ø–µ—Ä–∞—Ü–∏–∏ (–≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ)
- [x] Auto-provisioning
- [x] Queue management
- [x] Recording control
- [x] Dialplan management
- [x] Status monitoring
- [x] Validation

---

## üéì –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Python API
```python
from voip.backends.asteriskbackend import AsteriskRealtimeAPI
from django.conf import settings

config = next(b for b in settings.VOIP if b['PROVIDER'] == 'Asterisk')
api = AsteriskRealtimeAPI(**config['OPTIONS'])

# –°–æ–∑–¥–∞—Ç—å endpoint
api.create_endpoint('1000', 'user1000', context='from-internal')

# –ü–æ–∑–≤–æ–Ω–∏—Ç—å
api.originate_call('1000', '1001')

# –ó–∞–ø–∏—Å–∞—Ç—å
api.start_recording('PJSIP/1000-00000001', 'call-001')

# –û—á–µ—Ä–µ–¥—å
api.add_queue_member('support', 'PJSIP/1000')
```

### Django Admin
1. VOIP > PJSIP Endpoints - —Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
2. Actions: Test registration, Reload PJSIP
3. Live —Å—Ç–∞—Ç—É—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
4. Export dialplan

### Management –∫–æ–º–∞–Ω–¥—ã
```bash
# Setup
python manage.py setup_asterisk_realtime --help

# Test
python manage.py setup_asterisk_realtime --test-connection

# Provision
python manage.py setup_asterisk_realtime --provision-users
```

---

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- [ ] WebRTC gateway –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Asterisk queues (app_queue)
- [ ] CDR –∏–º–ø–æ—Ä—Ç –≤ Django
- [ ] Real-time events —á–µ—Ä–µ–∑ WebSocket
- [ ] Grafana –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [ ] Multi-tenant support

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –°–º. —Ñ–∞–π–ª—ã ASTERISK_*.md
- **–ü—Ä–∏–º–µ—Ä—ã**: –°–º. voip/README.md
- **Troubleshooting**: –°–º. ASTERISK_REALTIME_SETUP.md

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ READY FOR PRODUCTION  
**–í–µ—Ä—Å–∏—è**: 1.0.0  
**–î–∞—Ç–∞**: December 2024  
**–ê–≤—Ç–æ—Ä**: Django CRM Development Team
