{% load static i18n %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SIP Phone</title>
  <style>
    /* –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤–Ω–µ—à–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã –∏ —Ñ–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: transparent; /* –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω –≤–æ–∫—Ä—É–≥ */
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –≤–∏–¥–∂–µ—Ç, –µ—Å–ª–∏ –æ–Ω –æ–¥–∏–Ω –≤ iframe */
    }

    /* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ª–µ–≥–∫–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤ */
    :root {
      --widget-bg: #ffffff;
      --text-main: #1f2937;
      --text-muted: #9ca3af;
      --primary: #10b981; /* –ó–µ–ª–µ–Ω—ã–π (–∑–≤–æ–Ω–æ–∫) */
      --danger: #ef4444;  /* –ö—Ä–∞—Å–Ω—ã–π (—Å–±—Ä–æ—Å) */
      --key-bg: #f3f4f6;
      --key-active: #e5e7eb;
      --radius: 16px;
    }

    /* –°—Ç–∏–ª–∏ —Å–∞–º–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞ */
    .voip-widget {
      width: 280px;
      background: transparent; /* –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
      border-radius: var(--radius);
      box-shadow: none; /* –£–±–∏—Ä–∞–µ–º —Ç–µ–Ω—å */
      padding: 16px;
      box-sizing: border-box;
      border: none; /* –£–±–∏—Ä–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—É */
      display: flex;
      flex-direction: column;
      gap: 12px;
      /* –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –≤–Ω–µ—à–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã, —Ç–∞–∫ –∫–∞–∫ —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ body */
    }

    /* --- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å --- */
    .voip-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 24px;
    }
    .status-badge {
      font-size: 11px;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 10px;
      background: #f3f4f6;
      color: var(--text-muted);
    }
    .status-badge.connected { background: #d1fae5; color: #065f46; }

    .btn-icon {
      background: none; border: none; cursor: pointer; color: var(--text-muted);
      font-size: 16px; padding: 4px; transition: color 0.2s;
    }
    .btn-icon:hover { color: var(--text-main); }

    /* --- –î–∏—Å–ø–ª–µ–π --- */
    .voip-display { position: relative; margin-bottom: 4px; }
    .voip-input {
      width: 100%;
      border: none;
      background: transparent;
      font-size: 26px;
      font-weight: 600;
      text-align: center;
      color: var(--text-main);
      outline: none;
      padding: 0;
      letter-spacing: 1px;
    }
    .voip-input::placeholder { color: #e5e7eb; }

    /* --- –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ --- */
    .keypad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      justify-items: center;
    }
    .key {
      width: 48px; height: 48px;
      border-radius: 50%;
      background: var(--key-bg);
      border: none;
      cursor: pointer;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      transition: all 0.1s;
      user-select: none;
    }
    .key:active { background: var(--key-active); transform: scale(0.95); }
    .key-digit { font-size: 20px; font-weight: 500; color: var(--text-main); line-height: 1; }
    .key-sub { font-size: 8px; color: var(--text-muted); margin-top: 2px; font-weight: 700; }

    /* --- –ü–∞–Ω–µ–ª—å –¥–µ–π—Å—Ç–≤–∏–π --- */
    .action-bar {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      margin-top: 4px;
    }

    /* –ö–Ω–æ–ø–∫–∞ –≤—ã–∑–æ–≤–∞ */
    .btn-call {
      width: 56px; height: 56px;
      border-radius: 50%;
      border: none;
      color: white;
      font-size: 24px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);
      transition: all 0.2s;
      background: var(--primary);
    }
    .btn-call:active { transform: scale(0.95); }
    .btn-call:disabled { opacity: 0.4; cursor: not-allowed; box-shadow: none; background: #9ca3af; }

    .btn-call.hangup-mode {
      background: var(--danger);
      box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3);
    }

    /* –ú–∞–ª–µ–Ω—å–∫–∏–µ –∫–Ω–æ–ø–∫–∏ */
    .action-mini {
      background: transparent; border: none; cursor: pointer;
      display: flex; flex-direction: column; align-items: center;
      color: var(--text-muted); font-size: 10px; gap: 4px;
    }
    .action-mini span.icon {
      font-size: 16px; background: var(--key-bg); width: 32px; height: 32px;
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
    }
    .action-mini.active span.icon { background: var(--text-main); color: white; }

    .hidden { display: none !important; }
  </style>
</head>
<body>

<!-- Widget Start -->
<div class="voip-widget" role="region" aria-label="SIP Phone">

  <!-- Header -->
  <div class="voip-header">
    <button class="btn-icon" id="btn-settings" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öô</button>
    <div id="status" class="status-badge">Ready</div>
    <div style="width: 24px;"></div> <!-- Spacer -->
  </div>

  <!-- Display -->
  <div class="voip-display">
    <input id="target" class="voip-input" inputmode="tel" placeholder="..." autocomplete="off">
  </div>

  <!-- Keypad -->
  <div class="keypad">
    <button class="key" data-val="1"><span class="key-digit">1</span><span class="key-sub">&nbsp;</span></button>
    <button class="key" data-val="2"><span class="key-digit">2</span><span class="key-sub">ABC</span></button>
    <button class="key" data-val="3"><span class="key-digit">3</span><span class="key-sub">DEF</span></button>

    <button class="key" data-val="4"><span class="key-digit">4</span><span class="key-sub">GHI</span></button>
    <button class="key" data-val="5"><span class="key-digit">5</span><span class="key-sub">JKL</span></button>
    <button class="key" data-val="6"><span class="key-digit">6</span><span class="key-sub">MNO</span></button>

    <button class="key" data-val="7"><span class="key-digit">7</span><span class="key-sub">PQRS</span></button>
    <button class="key" data-val="8"><span class="key-digit">8</span><span class="key-sub">TUV</span></button>
    <button class="key" data-val="9"><span class="key-digit">9</span><span class="key-sub">WXYZ</span></button>

    <button class="key" data-val="*"><span class="key-digit">*</span></button>
    <button class="key" data-val="0"><span class="key-digit">0</span><span class="key-sub">+</span></button>
    <button class="key" data-val="#"><span class="key-digit">#</span></button>
  </div>

  <!-- Actions -->
  <div class="action-bar">
    <button id="mute_btn" class="action-mini" disabled title="Mute">
      <span class="icon">üé§</span>
      <span>Mute</span>
    </button>

    <!-- Combined Call/Hangup Button -->
    <button id="main_action_btn" class="btn-call disabled" aria-label="Call" disabled>
      <span id="icon_call">üìû</span>
      <span id="icon_hangup" class="hidden">‚úñ</span>
    </button>

    <button id="transfer_btn" class="action-mini" disabled title="Transfer">
      <span class="icon">‚Üó</span>
      <span>Trans</span>
    </button>
  </div>

</div>
<!-- Widget End -->

<!-- Javascript Logic -->
<script>
  document.addEventListener('DOMContentLoaded', function(){
    const target = document.getElementById('target');
    const mainBtn = document.getElementById('main_action_btn');
    const iconCall = document.getElementById('icon_call');
    const iconHangup = document.getElementById('icon_hangup');
    const muteBtn = document.getElementById('mute_btn');
    const transferBtn = document.getElementById('transfer_btn');
    const statusBadge = document.getElementById('status');
    const keys = document.querySelectorAll('.key');

    let inCall = false;

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫
    function updateButtonState() {
      if(inCall) {
        mainBtn.classList.remove('disabled');
        mainBtn.disabled = false;
        mainBtn.classList.add('hangup-mode');
        iconCall.classList.add('hidden');
        iconHangup.classList.remove('hidden');
        muteBtn.disabled = false;
        transferBtn.disabled = false;
      } else {
        mainBtn.classList.remove('hangup-mode');
        iconCall.classList.remove('hidden');
        iconHangup.classList.add('hidden');
        muteBtn.disabled = true;
        transferBtn.disabled = true;
        muteBtn.classList.remove('active');

        const hasNumber = !!target.value.trim();
        mainBtn.classList.toggle('disabled', !hasNumber);
        mainBtn.disabled = !hasNumber;
      }
    }

    target.addEventListener('input', updateButtonState);
    target.addEventListener('keyup', (e) => {
        if(e.key === 'Enter' && !mainBtn.disabled) mainBtn.click();
    });

    keys.forEach(k => {
      k.addEventListener('click', (e) => {
        const val = k.dataset.val;
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–≤—É–∫ –Ω–∞–∂–∞—Ç–∏—è
        target.value += val;
        updateButtonState();
      });
    });

    mainBtn.addEventListener('click', function() {
      if(inCall) {
        // –õ–æ–≥–∏–∫–∞ —Å–±—Ä–æ—Å–∞
        inCall = false;
        statusBadge.innerText = "Ready";
        statusBadge.classList.remove('connected');
      } else {
        // –õ–æ–≥–∏–∫–∞ –≤—ã–∑–æ–≤–∞
        if(target.value.trim()) {
          inCall = true;
          statusBadge.innerText = "Calling...";
          statusBadge.classList.add('connected');
        }
      }
      updateButtonState();
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    updateButtonState();
  });
</script>

</body>
</html>
