# üìû VoIP –¢–µ–ª–µ—Ñ–æ–Ω–∏—è –¥–ª—è Django CRM

## –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å VoIP –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏:
- **Asterisk PBX** - –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ AMI (Asterisk Manager Interface)
- **OnlinePBX** - –æ–±–ª–∞—á–Ω–∞—è —Ç–µ–ª–µ—Ñ–æ–Ω–∏—è
- **Zadarma** - VoIP –ø—Ä–æ–≤–∞–π–¥–µ—Ä

# üìû VoIP –¢–µ–ª–µ—Ñ–æ–Ω–∏—è –¥–ª—è Django CRM

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ VoIP —Ç–µ–ª–µ—Ñ–æ–Ω–∏–∏ —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üì± –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
- **–í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é** —Å —Ü–∏—Ñ—Ä–æ–≤—ã–º –±–ª–æ–∫–æ–º (1-9, *, 0, #)
- **–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –Ω–∞–±–æ—Ä–∞
- **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω** —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å JsSIP** –∫–ª–∏–µ–Ω—Ç–æ–º

### üè¢ –°–∏—Å—Ç–µ–º–∞ SIP –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–∫–∞–∫ –≤ –ë–∏—Ç—Ä–∏–∫—Å24)
- **SipServer** - —Å–µ—Ä–≤–µ—Ä—ã SIP —Å WebSocket URI
- **InternalNumber** - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ —Å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
- **SipAccount** - –∞–∫–∫–∞—É–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ** –Ω–æ–º–µ—Ä–æ–≤ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### üë• –ì—Ä—É–ø–ø—ã –Ω–æ–º–µ—Ä–æ–≤ –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
- **NumberGroup** - –≥—Ä—É–ø–ø—ã —Å 5 —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- **CallRoutingRule** - –≥–∏–±–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
- **CallQueue** - –æ—á–µ—Ä–µ–¥–∏ –∑–≤–æ–Ω–∫–æ–≤ —Å —Ç–∞–π–º-–∞—É—Ç–∞–º–∏
- **CallLog** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–≤–æ–Ω–∫–æ–≤

### üìä –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- **–î–∞—à–±–æ—Ä–¥ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏** —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—á–µ—Ä–µ–¥–µ–π** –ø—Ä—è–º–æ –≤ Django –∞–¥–º–∏–Ω–∫–µ
- **–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** —Å –≤–µ–±-—Ñ–æ—Ä–º–∞–º–∏ –≤ –∞–¥–º–∏–Ω–∫–µ
- **Live –≤–∏–¥–∂–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** —Å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥

### üîî –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- **Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–≤–æ–Ω–∫–∞—Ö
- **Webhook –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á** –≤ CRM
- **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã** –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤

### üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å PBX
- **Asterisk AMI** - –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
  - ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞–º–∏ (originate, transfer, park, hangup)
  - ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—á–µ—Ä–µ–¥–µ–π –∏ –∞–≥–µ–Ω—Ç–æ–≤
  - ‚úÖ –ò–º–ø–æ—Ä—Ç CDR –∑–∞–ø–∏—Å–µ–π
  - ‚úÖ Health checks –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã
  - ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö AMI —Å–æ–±—ã—Ç–∏–π
- **FreeSWITCH ESL** - —Å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π dialplan
- **Zadarma webhook** - –≥–æ—Ç–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
```bash
python manage.py migrate voip
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–≤–æ–≥–æ SIP —Å–µ—Ä–≤–µ—Ä–∞
```bash
python manage.py setup_sip_system \
    --server-host sip.example.com \
    --websocket-uri wss://sip.example.com:7443 \
    --create-accounts
```

### 3. –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º

#### Django –ê–¥–º–∏–Ω–∫–∞
- **–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VoIP**: http://localhost:8000/admin/voip-management/
- **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏**: http://localhost:8000/admin/voip/

#### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- **–î–∞—à–±–æ—Ä–¥ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏**: http://localhost:8000/voip/dashboard/
- **JsSIP –∫–ª–∏–µ–Ω—Ç**: http://localhost:8000/voip/client/

#### –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ –∞–¥–º–∏–Ω–∫–µ
- **–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VoIP**: http://localhost:8000/admin/voip-management/
  - –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤–∏–¥–∂–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å –∫–Ω–æ–ø–∫–æ–π "üì± –ú–æ–Ω–∏—Ç–æ—Ä –æ—á–µ—Ä–µ–¥–µ–π"
- **–ê–¥–º–∏–Ω–∫–∞ –æ—á–µ—Ä–µ–¥–µ–π**: http://localhost:8000/admin/voip/callqueue/
  - Live –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞–¥ —Å–ø–∏—Å–∫–æ–º –∑–∞–ø–∏—Å–µ–π –æ—á–µ—Ä–µ–¥–µ–π
- **–ê–¥–º–∏–Ω–∫–∞ –≥—Ä—É–ø–ø**: http://localhost:8000/admin/voip/numbergroup/
  - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—á–µ—Ä–µ–¥–µ–π –≤—Å–µ—Ö –≥—Ä—É–ø–ø

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SIP —Å–µ—Ä–≤–µ—Ä–∞
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ê–¥–º–∏–Ω–∫–∞ ‚Üí VoIP –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SIP —Å–µ—Ä–≤–µ—Ä–∞**
2. –£–∫–∞–∂–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤–∞—à–µ–≥–æ SIP —Å–µ—Ä–≤–µ—Ä–∞:
   - **–ù–∞–∑–≤–∞–Ω–∏–µ**: –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –∏–º—è
   - **–•–æ—Å—Ç**: sip.example.com
   - **WebSocket URI**: wss://sip.example.com:7443
   - **Realm**: (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é = —Ö–æ—Å—Ç)
3. –û—Ç–º–µ—Ç—å—Ç–µ **"–°–æ–∑–¥–∞—Ç—å SIP –∞–∫–∫–∞—É–Ω—Ç—ã"** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –Ω–æ–º–µ—Ä–æ–≤
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ê–¥–º–∏–Ω–∫–∞ ‚Üí VoIP –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã**
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - **–ù–∞–∑–≤–∞–Ω–∏–µ**: –û—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂
   - **–û–ø–∏—Å–∞–Ω–∏–µ**: –ì—Ä—É–ø–ø–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º
   - **SIP —Å–µ—Ä–≤–µ—Ä**: –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞
   - **–°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è**:
     - `Round Robin` - –ø–æ –æ—á–µ—Ä–µ–¥–∏
     - `Random` - —Å–ª—É—á–∞–π–Ω–æ
     - `Priority` - –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
     - `Ring All` - –∑–≤–æ–Ω–∏—Ç—å –≤—Å–µ–º
     - `Least Recent` - –∫–æ–º—É –¥–∞–≤–Ω–æ –Ω–µ –∑–≤–æ–Ω–∏–ª–∏
   - **–£—á–∞—Å—Ç–Ω–∏–∫–∏**: –í—ã–±–µ—Ä–∏—Ç–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–æ–º–µ—Ä–∞
   - **–í—Ä–µ–º—è –∑–≤–æ–Ω–∫–∞**: 30 —Å–µ–∫—É–Ω–¥
   - **–†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏**: 10 –∑–≤–æ–Ω—è—â–∏—Ö

### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ê–¥–º–∏–Ω–∫–∞ ‚Üí VoIP –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Üí –ü—Ä–∞–≤–∏–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏**
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª–æ:
   - **–ù–∞–∑–≤–∞–Ω–∏–µ**: –ú–æ–±–∏–ª—å–Ω—ã–µ –Ω–∞ –ø—Ä–æ–¥–∞–∂–∏
   - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: 100 (–º–µ–Ω—å—à–µ = –≤—ã—à–µ)
   - **–ü–∞—Ç—Ç–µ—Ä–Ω –∑–≤–æ–Ω—è—â–µ–≥–æ**: `^\\+79` (—Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –º–æ–±–∏–ª—å–Ω—ã–µ)
   - **–î–µ–π—Å—Ç–≤–∏–µ**: –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –≤ –≥—Ä—É–ø–ø—É
   - **–¶–µ–ª–µ–≤–∞—è –≥—Ä—É–ø–ø–∞**: –û—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ê–¥–º–∏–Ω–∫–∞ ‚Üí VoIP –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Üí –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –∏ –≥—Ä—É–ø–ø—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–≤–æ–Ω–∫–æ–≤

## üìä API Endpoints

### –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–≤–æ–Ω–∫–æ–≤
```bash
# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–≤–æ–Ω–∫–∞
POST /voip/incoming/
{
    "caller_id": "+79001234567",
    "called_number": "100",
    "session_id": "call_abc123"
}

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–≤–æ–Ω–∫–∞
POST /voip/status/
{
    "session_id": "call_abc123",
    "status": "answered",
    "answer_time": "2023-12-01T10:30:15Z"
}

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—è–º–∏
GET /voip/queue/
POST /voip/queue/

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–≤–æ–Ω–∫–æ–≤
GET /voip/stats/?period=7&group_id=1
```

### –î–∞—à–±–æ—Ä–¥ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞
GET /voip/api/dashboard/stats/

# –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≥—Ä—É–ø–ø  
GET /voip/api/dashboard/groups/

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–≤–æ–Ω–∫–∏
GET /voip/api/dashboard/recent-calls/

# –ñ–∏–≤—ã–µ –æ—á–µ—Ä–µ–¥–∏
GET /voip/api/dashboard/live-queue/

# –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
GET /voip/api/system/status/
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Celery (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install celery redis
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ settings.py
```python
# Celery Configuration
CELERY_BROKER_URL = 'redis://localhost:6379/0'
CELERY_RESULT_BACKEND = 'redis://localhost:6379/0'

# VoIP Celery Tasks
from celery.schedules import crontab

CELERY_BEAT_SCHEDULE = {
    'process-missed-calls': {
        'task': 'voip.process_missed_calls',
        'schedule': 60.0,  # –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    },
    'monitor-queue-health': {
        'task': 'voip.monitor_queue_health',
        'schedule': 30.0,  # –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    },
    'generate-daily-report': {
        'task': 'voip.generate_daily_report',
        'schedule': crontab(hour=9, minute=0),  # –í 09:00 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
    },
}
```

### –ó–∞–ø—É—Å–∫ Celery
```bash
# Worker –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á
celery -A webcrm worker -l info

# Beat –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á  
celery -A webcrm beat -l info
```

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SIP —Å–µ—Ä–≤–µ—Ä–∞–º–∏

### Asterisk AMI
```python
# settings.py
ASTERISK_AMI = {
    'HOST': 'localhost',
    'PORT': 5038,
    'USERNAME': 'django_crm',
    'SECRET': 'your_secret_password',
    'USE_SSL': False,
}

# –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
python manage.py shell
>>> from voip.integrations.asterisk import start_asterisk_integration
>>> import asyncio
>>> asyncio.run(start_asterisk_integration())
```

### FreeSWITCH ESL
```python
# settings.py
FREESWITCH_ESL = {
    'HOST': 'localhost',
    'PORT': 8021,
    'PASSWORD': 'ClueCon',
}

# –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
python manage.py shell
>>> from voip.integrations.freeswitch import start_freeswitch_integration
>>> import asyncio
>>> asyncio.run(start_freeswitch_integration())
```

## üìß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```python
# settings.py
VOIP_EMAIL_NOTIFICATIONS = True
EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
EMAIL_HOST = 'smtp.gmail.com'
EMAIL_PORT = 587
EMAIL_USE_TLS = True
EMAIL_HOST_USER = 'your-email@gmail.com'
EMAIL_HOST_PASSWORD = 'your-app-password'
DEFAULT_FROM_EMAIL = 'VoIP System <your-email@gmail.com>'
```

### Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```python
# settings.py
VOIP_WEBHOOK_NOTIFICATIONS = True
VOIP_WEBHOOK_URL = 'https://your-webhook-url.com/voip-events'
```

## üé® –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

### –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
- **0-9, *, #** - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ü–∏—Ñ—Ä –≤ –ø–æ–ª–µ –Ω–æ–º–µ—Ä–∞
- **Enter** - –°–æ–≤–µ—Ä—à–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞
- **Backspace** - –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ü–∏—Ñ—Ä—ã  
- **Escape** - –ó–∞–∫—Ä—ã—Ç–∏–µ –¥–∏–∞–ª–µ—Ä–∞

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
1. –û—Ç–∫—Ä–æ–π—Ç–µ JsSIP –∫–ª–∏–µ–Ω—Ç: `/voip/client/`
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ üìû
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –Ω–∞–±–æ—Ä–∞ –Ω–æ–º–µ—Ä–∞
4. –ù–∞–∂–º–∏—Ç–µ "Call" –∏–ª–∏ Enter –¥–ª—è –∑–≤–æ–Ω–∫–∞

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ VoIP
tail -f logs/voip.log

# –õ–æ–≥–∏ Django
tail -f logs/django.log
```

### –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ –∞–¥–º–∏–Ω–∫–µ
- **üë• –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç—ã** - —Å–æ–∑–¥–∞—Ç—å SIP –∞–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–∞–≤–∏–ª
- **üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã** - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```bash
# –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å
python manage.py manage_call_routing stats --group-id 1
python manage.py manage_call_routing list --groups
python manage.py manage_call_routing test --caller-id "+79001234567" --called-number "100"
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è webhook'–æ–≤
```python
# voip/views/voipwebhook.py
def is_authenticated(request, data):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook'–∞
    # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è Zadarma –∏ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
```

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- –í—Å–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç `staff_member_required`
- API endpoints –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- SIP –ø–∞—Ä–æ–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î

## üîß Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**1. –û—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
python manage.py migrate voip
```

**2. SIP –∫–ª–∏–µ–Ω—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ WebSocket URI –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç SSL –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –¥–ª—è WSS
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–∞ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞

**3. –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –ø—Ä–∞–≤–∏–ª (–º–µ–Ω—å—à–µ = –≤—ã—à–µ)
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–∞–≤–∏–ª–∞ –∞–∫—Ç–∏–≤–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ regex –ø–∞—Ç—Ç–µ—Ä–Ω—ã

**4. –ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–≤–æ–Ω–∫–∞—Ö**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ email –≤ Django
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Celery –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–º–æ—â–∏
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Django –∏ VoIP –º–æ–¥—É–ª—è
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã"** –≤ –∞–¥–º–∏–Ω–∫–µ
3. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–∏—Å—Ç–µ–º—ã –≤ –¥–∞—à–±–æ—Ä–¥–µ

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é Django CRM —Å–∏—Å—Ç–µ–º—ã –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ —Ç–æ–π –∂–µ –ª–∏—Ü–µ–Ω–∑–∏–µ–π.

## ü§ù –í–∫–ª–∞–¥ –≤ —Ä–∞–∑–≤–∏—Ç–∏–µ

–ú—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º –≤–∫–ª–∞–¥ –≤ —Ä–∞–∑–≤–∏—Ç–∏–µ —Å–∏—Å—Ç–µ–º—ã VoIP —Ç–µ–ª–µ—Ñ–æ–Ω–∏–∏:

1. –°–æ–∑–¥–∞–π—Ç–µ Issue –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ Pull Request —Å –≤–∞—à–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
3. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
4. –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

## üìã –ë—ã—Å—Ç—Ä–∞—è —Å–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/admin/voip-management/` | –ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| `/voip/dashboard/` | –î–∞—à–±–æ—Ä–¥ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ |
| `/voip/monitor/` | –ú–æ–Ω–∏—Ç–æ—Ä –æ—á–µ—Ä–µ–¥–µ–π |
| `/voip/client/` | SIP –∫–ª–∏–µ–Ω—Ç |
| `setup_sip_system --help` | –ü–æ–º–æ—â—å –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ |
| `manage_call_routing --help` | –ü–æ–º–æ—â—å –ø–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ |

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ**

---

## üì° –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Asterisk PBX

### –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Asterisk

#### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AMI –≤ Asterisk

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `/etc/asterisk/manager.conf`:

```ini
[general]
enabled = yes
port = 5038
bindaddr = 0.0.0.0

[django_crm]
secret = YourSecurePassword123!
deny = 0.0.0.0/0.0.0.0
permit = 192.168.1.0/255.255.255.0
read = system,call,log,agent,user,config,command,originate
write = system,call,log,agent,user,config,command,originate
```

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
```bash
sudo asterisk -rx "manager reload"
```

#### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Django CRM

–î–æ–±–∞–≤—å—Ç–µ –≤ `settings.py`:

```python
ASTERISK_AMI = {
    'HOST': '192.168.1.100',
    'PORT': 5038,
    'USERNAME': 'django_crm',
    'SECRET': 'YourSecurePassword123!',
    'USE_SSL': False,
    'CONNECT_TIMEOUT': 5,
    'RECONNECT_DELAY': 5,
    'DEBUG_MODE': False,
}
```

#### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
python manage.py test_asterisk_connection

# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å –æ—á–µ—Ä–µ–¥—è–º–∏
python manage.py test_asterisk_connection --full --queues

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—á–µ—Ä–µ–¥–µ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
python manage.py asterisk_queue_stats --watch
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞–º–∏ —á–µ—Ä–µ–∑ Python API

```python
from voip.ami import AmiClient
from voip.integrations.asterisk_control import AsteriskCallControl
from voip.utils import load_asterisk_config

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Asterisk
config = load_asterisk_config()
client = AmiClient(config)
client.connect()

control = AsteriskCallControl(client)

# –ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –∑–≤–æ–Ω–æ–∫
control.originate(
    channel='SIP/101',
    extension='1234567890',
    caller_id='Company <+1234567890>'
)

# –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –∑–≤–æ–Ω–æ–∫
control.transfer(
    channel='SIP/101-00000001',
    extension='102',
    context='internal'
)

# –ü—Ä–∏–ø–∞—Ä–∫–æ–≤–∞—Ç—å –∑–≤–æ–Ω–æ–∫
control.park(channel='SIP/101-00000001')

# –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–≤–æ–Ω–æ–∫
control.hangup(channel='SIP/101-00000001')

client.close()
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—è–º–∏

```python
from voip.integrations.asterisk_queue import AsteriskQueueMonitor

monitor = AsteriskQueueMonitor(client)

# –î–æ–±–∞–≤–∏—Ç—å –∞–≥–µ–Ω—Ç–∞ –≤ –æ—á–µ—Ä–µ–¥—å
monitor.add_queue_member(
    queue='support',
    interface='SIP/101',
    member_name='John Doe'
)

# –ü–æ—Å—Ç–∞–≤–∏—Ç—å –∞–≥–µ–Ω—Ç–∞ –Ω–∞ –ø–∞—É–∑—É
monitor.pause_queue_member(
    queue='support',
    interface='SIP/101',
    paused=True,
    reason='Break'
)

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ—á–µ—Ä–µ–¥–∏
summary = monitor.get_queue_summary('support')
print(f"Waiting calls: {summary['calls_waiting']}")
print(f"Available agents: {summary['available_agents']}")
print(f"Longest wait: {summary['longest_wait']}s")
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã

```python
from voip.utils.asterisk_health import AsteriskHealthCheck

health = AsteriskHealthCheck(client)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
connection = health.check_connection()
print(f"Status: {connection['status']}")
print(f"Response time: {connection['response_time']}ms")

# –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
report = health.get_full_health_report()
print(f"Overall status: {report['overall_status']}")
print(f"Active channels: {report['checks']['channels']['active_channels']}")
print(f"SIP peers online: {report['checks']['channels']['sip_peers']['online']}")

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞ –∑–≤–æ–Ω–∫–æ–≤
quality = health.monitor_call_quality(threshold_seconds=3600)
print(f"Completed calls: {quality['completed_calls']}/{quality['total_calls']}")
print(f"Average duration: {quality['avg_duration']}s")
```

### –ò–º–ø–æ—Ä—Ç CDR –∑–∞–ø–∏—Å–µ–π

```python
from voip.utils.cdr_import import AsteriskCDRImporter

importer = AsteriskCDRImporter()

# –ò–º–ø–æ—Ä—Ç –∏–∑ CSV
result = importer.import_from_csv('/var/log/asterisk/cdr-csv/Master.csv')

# –ò–º–ø–æ—Ä—Ç –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
db_config = {
    'host': '192.168.1.100',
    'user': 'asteriskcdr',
    'password': 'password',
    'database': 'asteriskcdrdb',
}

from datetime import datetime, timedelta
end_date = datetime.now()
start_date = end_date - timedelta(days=7)

result = importer.import_from_database(db_config, start_date, end_date)
print(f"Imported: {result['imported']}, Skipped: {result['skipped']}")
```

### Management –∫–æ–º–∞–Ω–¥—ã

```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
python manage.py test_asterisk_connection
python manage.py test_asterisk_connection --full --queues

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–µ–π
python manage.py asterisk_queue_stats
python manage.py asterisk_queue_stats --queue support
python manage.py asterisk_queue_stats --watch

# –ò–º–ø–æ—Ä—Ç CDR
python manage.py import_asterisk_cdr --source database --days 7
python manage.py import_asterisk_cdr --source csv --file /path/to/Master.csv

# –ó–∞–ø—É—Å–∫ AMI listener
python manage.py listen_asterisk_ami
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞–º–∏ (AsteriskCallControl)
- ‚úÖ `originate()` - –∏–Ω–∏—Ü–∏–∞—Ü–∏—è –∏—Å—Ö–æ–¥—è—â–∏—Ö –∑–≤–æ–Ω–∫–æ–≤
- ‚úÖ `hangup()` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤
- ‚úÖ `transfer()` - –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è –∑–≤–æ–Ω–∫–æ–≤
- ‚úÖ `park()` - –ø–∞—Ä–∫–æ–≤–∫–∞ –∑–≤–æ–Ω–∫–æ–≤
- ‚úÖ `spy()` - –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤ (listen/whisper/barge)
- ‚úÖ `bridge_channels()` - —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤
- ‚úÖ `send_dtmf()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ DTMF —Å–∏–≥–Ω–∞–ª–æ–≤
- ‚úÖ `get_channel_info()` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–Ω–∞–ª–µ
- ‚úÖ `get_active_channels()` - —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—è–º–∏ (AsteriskQueueMonitor)
- ‚úÖ `get_queue_status()` - —Å—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–µ–π
- ‚úÖ `add_queue_member()` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞
- ‚úÖ `remove_queue_member()` - —É–¥–∞–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞
- ‚úÖ `pause_queue_member()` - –ø–∞—É–∑–∞ –∞–≥–µ–Ω—Ç–∞
- ‚úÖ `set_member_penalty()` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
- ‚úÖ `get_queue_summary()` - —Å–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚úÖ `reload_queue()` - –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (AsteriskHealthCheck)
- ‚úÖ `check_connection()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- ‚úÖ `get_system_info()` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
- ‚úÖ `check_channels_availability()` - –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–∞–Ω–∞–ª–æ–≤
- ‚úÖ `check_queues_health()` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π
- ‚úÖ `get_full_health_report()` - –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç
- ‚úÖ `monitor_call_quality()` - –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤–æ–Ω–∫–æ–≤

#### CDR –∏–º–ø–æ—Ä—Ç (AsteriskCDRImporter)
- ‚úÖ `import_from_csv()` - –∏–º–ø–æ—Ä—Ç –∏–∑ CSV —Ñ–∞–π–ª–∞
- ‚úÖ `import_from_database()` - –∏–º–ø–æ—Ä—Ç –∏–∑ –ë–î Asterisk
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ CRM
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

### –û–±—Ä–∞–±–æ—Ç–∫–∞ AMI —Å–æ–±—ã—Ç–∏–π

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ AMI —Å–æ–±—ã—Ç–∏—è:

**–ë–∞–∑–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –∑–≤–æ–Ω–∫–æ–≤:**
- `Newchannel` - –Ω–æ–≤—ã–π –∫–∞–Ω–∞–ª
- `Dial` - –Ω–∞—á–∞–ª–æ –Ω–∞–±–æ—Ä–∞
- `Bridge` - —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤
- `Hangup` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞
- `DialEnd` - –æ–∫–æ–Ω—á–∞–Ω–∏–µ –Ω–∞–±–æ—Ä–∞

**–°–æ–±—ã—Ç–∏—è –æ—á–µ—Ä–µ–¥–µ–π:**
- `QueueCallerJoin` - –≤—Ö–æ–¥ –≤ –æ—á–µ—Ä–µ–¥—å
- `QueueCallerLeave` - –≤—ã—Ö–æ–¥ –∏–∑ –æ—á–µ—Ä–µ–¥–∏
- `QueueCallerAbandon` - –±—Ä–æ—à–µ–Ω–Ω—ã–π –∑–≤–æ–Ω–æ–∫
- `QueueMemberStatus` - —Å—Ç–∞—Ç—É—Å –∞–≥–µ–Ω—Ç–∞
- `AgentConnect` - —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –∞–≥–µ–Ω—Ç–æ–º
- `AgentComplete` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:**
- `VarSet` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- `UserEvent` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è
- `Redirect` - –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è
- `ParkedCall` - –ø–∞—Ä–∫–æ–≤–∫–∞
- `ConfbridgeJoin/Leave` - –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏

### –ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–ø–ª–∞–Ω–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```ini
[from-external]
exten => _X.,1,NoOp(Incoming from ${CALLERID(num)})
    same => n,Set(CHANNEL(language)=ru)
    
    ; –ó–∞–ø—Ä–æ—Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∫ Django CRM API
    same => n,Set(CRM_ROUTE=${CURL(http://crm.example.com/api/voip/route/${CALLERID(num)}/${EXTEN})})
    same => n,GotoIf($["${CRM_ROUTE}" != ""]?route:queue)
    
    same => n(route),Dial(SIP/${CRM_ROUTE},30,tT)
    same => n,Goto(after-dial)
    
    same => n(queue),Queue(support,t,,,300)
    
    same => n(after-dial),Hangup()
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–í–∞–∂–Ω–æ!** AMI –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ Asterisk. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏
2. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –ø–æ IP (permit/deny)
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSL/TLS –¥–ª—è AMI (–ø–æ—Ä—Ç 5039)
4. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å
5. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ Asterisk

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: [docs/site/asterisk_integration_guide.md](../../docs/site/asterisk_integration_guide.md)

---

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ**

## üì° –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Asterisk Real-time

Django CRM –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Asterisk PBX —á–µ—Ä–µ–∑ Real-time –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –°–∞–º Asterisk –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –∫–∞–∫ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –≤ —Å—Ç–µ–∫–µ CRM (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ docker-compose) –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä—è–º–æ –∏–∑ —Å–∏—Å—Ç–µ–º—ã.

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ provisioning** SIP endpoints –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ AMI** - –∏–Ω–∏—Ü–∏–∞—Ü–∏—è –∑–≤–æ–Ω–∫–æ–≤, –∑–∞–ø–∏—Å—å —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤
- **Real-time –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- **–ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ PJSIP** —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–ø–ª–∞–Ω–æ–º** –∏–∑ CRM
- **–û—á–µ—Ä–µ–¥–∏ –∏ –≥—Ä—É–ø–ø—ã –∑–≤–æ–Ω–∫–æ–≤**
- **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–≤–æ–Ω–∫–æ–≤ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–°–º. –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: **[ASTERISK_REALTIME_SETUP.md](../ASTERISK_REALTIME_SETUP.md)**

- Asterisk —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å (—Å–µ—Ä–≤–µ—Ä/VM –∏–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä). –í dev –º–æ–∂–Ω–æ –ø–æ–¥–Ω—è—Ç—å Asterisk 21 –≤ docker-compose ‚Äî –ø—Ä–∏–º–µ—Ä —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ –µ—Å—Ç—å –≤ `ASTERISK_REALTIME_SETUP.md`.

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Asterisk 21 —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π realtime (res_pjsip + res_odbc)
sudo apt-get install asterisk

# 2. –£–∫–∞–∂–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è ASTERISK_DB_* –∏ ASTERISK_AMI_* (—Å–º. ASTERISK_REALTIME_SETUP.md)

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ realtime –±–∞–∑–µ
python manage.py migrate --database=asterisk --fake-initial

# 4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—ã/–Ω–æ–º–µ—Ä–∞
python manage.py setup_asterisk_realtime --create-transports --provision-users

# 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
python manage.py setup_asterisk_realtime --test-connection
```

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ](../ASTERISK_REALTIME_SETUP.md)
- [Backend API](backends/asteriskbackend.py)
- [–£—Ç–∏–ª–∏—Ç—ã](utils/asterisk_realtime.py)
- [Management –∫–æ–º–∞–Ω–¥—ã](management/commands/setup_asterisk_realtime.py)
