{% load i18n %}
<div class="lead-sources-widget">
  <div class="widget-header">
    <h3 class="widget-title">{% trans "Lead Sources" %}</h3>
    <div class="summary-stats">
      <span class="stat">{{ total_leads }} {% trans "leads" %}</span>
      <span class="stat success">{{ conversion_rate }}% {% trans "conversion" %}</span>
    </div>
  </div>
  <div class="chart-and-list">
    <div class="chart-section">
      {% if img %}
        <img src="{{ img }}" alt="Lead sources" style="width:100%;height:auto;" />
      {% else %}
        <div class="text-muted">{% trans "No data to render chart." %}</div>
      {% endif %}
    </div>
    <div class="sources-list">
      {% for source in sources_data %}
        <div class="source-item">
          <div class="source-name">{{ source.lead_source__name|default:"Unknown" }}</div>
          <div class="source-stats">
            <span class="leads-count">{{ source.count }} {% trans "leads" %}</span>
            <span class="conversion-rate">{{ source.converted }} {% trans "converted" %}</span>
            <div class="progress-bar"><div class="progress-fill" style="width: {% widthratio source.converted source.count 100 %}%"></div></div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>
<style>
  .lead-sources-widget{background:#fff;border-radius:8px;padding:20px;box-shadow:0 2px 4px rgba(0,0,0,.1);margin-bottom:20px}
  .widget-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;border-bottom:1px solid #eee;padding-bottom:12px}
  .summary-stats{display:flex;gap:10px}
  .chart-and-list{display:grid;grid-template-columns:1fr 1fr;gap:20px}
  .sources-list{max-height:300px;overflow:auto}
  .progress-bar{flex:1;height:4px;background:#e9ecef;border-radius:2px;overflow:hidden}
  .progress-fill{height:100%;background:linear-gradient(90deg,#007bff,#0056b3)}
  @media(max-width:768px){.chart-and-list{grid-template-columns:1fr}}
</style>
