{% extends "admin/base.html" %}{% load static i18n %}

{% block extrahead %}{{ block.super }}
  <script>
    window.COMM_DEFAULTS = {
      sms_channel_id: {{ comm_sms_channel_id|default:'null' }},
      enable_sms: {{ comm_enable_sms|yesno:'true,false' }},
      enable_telegram: {{ comm_enable_telegram|yesno:'true,false' }},
      enable_instagram: {{ comm_enable_instagram|yesno:'true,false' }},
      enable_call: {{ comm_enable_call|yesno:'true,false' }}
    };
  </script>
  <script src="{% static 'admin/js/modern_admin.js' %}" defer></script>
{% endblock %}

{% block title %}
    {% if subtitle %}{{ subtitle }} | {% endif %}
    {# CRM: add prefix "A:"  for admin page title #}
    {% if "admin" in request.META.PATH_INFO %}A: {% endif %}
    {{ title }} | {{ site_title }}
{% endblock %}

{% block branding %}
<div id="site-name"><a href="{% url 'admin:index' %}">
    {# CRM: add Django-CRM Logo #}
    <img src="{% static 'common/django-crm_logo_24px.svg' %}" alt="Django-CRM Logo" style="vertical-align: sub;"> {{ site_header }}</a>
    {% if user.is_authenticated %}
      <a href="{% url 'admin:system-settings' %}" class="button" style="margin-left:12px;">{% translate 'System settings' %}</a>
    {% endif %}
</div>
{% if user.is_anonymous %}
  {% include "admin/color_theme_toggle.html" %}
{% endif %}
{% endblock %}

{% block nav-global %}
  {% if user.is_authenticated %}
    <style>
      .sip-nav-link {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin-right: 16px;
        padding: 6px 10px;
        border-radius: 999px;
        background: var(--primary);
        color: #fff !important;
        font-weight: 600;
        text-decoration: none;
        box-shadow: 0 6px 20px rgba(99,102,241,0.35);
      }
      .sip-nav-link:hover { transform: translateY(-1px); }
      .sip-nav-link span { font-size: 13px; }
      #sip-modal {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.6);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 2000;
      }
      #sip-modal .modal-body {
        width: min(95vw, 1100px);
        height: min(90vh, 780px);
        background: #0f172a;
        border-radius: 16px;
        border: 1px solid #1f2937;
        overflow: hidden;
        box-shadow: 0 24px 70px rgba(0,0,0,0.45);
      }
      #sip-modal iframe {
        width: 100%;
        height: 100%;
        border: none;
      }
    </style>
    <a class="sip-nav-link" href="#" id="sip-open">
      <span>â˜Ž</span>
      <span>{% translate "SIP client" %}</span>
    </a>
    <div id="sip-modal">
      <div class="modal-body">
        <iframe src="{% url 'voip:voip_sipml_client' %}" title="{% translate 'SIP client' %}"></iframe>
      </div>
    </div>
    <script>
      (function() {
        const openBtn = document.getElementById('sip-open');
        const modal = document.getElementById('sip-modal');
        if (!openBtn || !modal) return;
        openBtn.addEventListener('click', function (e) {
          e.preventDefault();
          modal.style.display = 'flex';
        });
        modal.addEventListener('click', function (e) {
          if (e.target === modal) modal.style.display = 'none';
        });
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') modal.style.display = 'none';
        });
      })();
    </script>
  {% endif %}
{% endblock %}
